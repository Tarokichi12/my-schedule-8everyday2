<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚­ãƒ©ã‚­ãƒ©æˆé•·è¨˜éŒ²âœ¨</title>

    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2362/2362789.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2362/2362789.png">

    <style>
        :root {
            --main-pink: #ffb7c5; 
            --sub-pink: #ffe4e8;
            --accent-pink: #ff85a1;
            --bg-color: #fffafb;
            --gray-out: #f0f0f0;
            --juku-color: #ff9f43;
            --eng-color: #a29bfe;
            --book-color: #55efc4;
        }

        #main-wrapper { display: none; }

        body { 
            font-family: 'Hiragino Maru Gothic ProN', 'Hiragino Sans', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; 
            text-align: center; 
            color: #5d5d5d;
            overflow-x: hidden;
        }
        
        .top-nav { 
            background: white; 
            padding: 5px 10px; 
            box-shadow: 0 2px 10px rgba(255, 183, 197, 0.3); 
            position: sticky; top: 0; z-index: 1000;
        }
        h1 { color: var(--accent-pink); font-size: 0.95rem; margin: 2px 0; }
        .date-display { 
            font-weight: bold; font-size: 0.8rem; color: var(--accent-pink); 
            margin: 2px 0; display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .date-display button {
            background: var(--sub-pink); border: none; border-radius: 50%; width: 22px; height: 22px; color: var(--accent-pink); font-weight: bold;
        }

        .palette { 
            background: #fff; padding: 6px; display: flex; flex-wrap: wrap; 
            justify-content: center; gap: 5px; border-bottom: 2px dotted var(--main-pink); 
        }
        .palette-btn { 
            padding: 5px 8px; border-radius: 15px; border: 1.5px solid var(--sub-pink); 
            background: white; cursor: pointer; font-size: 10px; font-weight: bold; color: #777;
            box-shadow: 0 2px 0 var(--sub-pink);
        }
        .palette-btn.active { 
            border-color: var(--accent-pink); background: var(--sub-pink); 
            color: var(--accent-pink); transform: translateY(1px); box-shadow: none;
        }

        .scroll-container { overflow: auto; height: 50vh; background: white; -webkit-overflow-scrolling: touch; }
        table { border-collapse: collapse; min-width: 900px; width: 100%; table-layout: fixed; }
        thead th { 
            position: sticky; top: 0; z-index: 400; background-color: var(--main-pink); 
            color: white; padding: 4px 2px; border: 1px solid white; font-size: 0.7rem; 
        }
        .time-col { 
            background: var(--sub-pink); font-weight: bold; width: 40px; 
            position: sticky; left: 0; z-index: 300; vertical-align: middle; 
            border: 1px solid white; font-size: 0.65rem; color: var(--accent-pink);
        }
        
        td { height: 65px; border: 1px solid var(--sub-pink); vertical-align: top; cursor: pointer; position: relative; }
        .content { font-size: 10px; font-weight: bold; padding: 2px 1px; word-break: break-all; line-height: 1.1; }
        .today-highlight { background-color: #fffdeb !important; }

        .done-wrapper { 
            display: flex; align-items: center; justify-content: center; 
            position: absolute; bottom: 2px; width: 100%; font-size: 8px; color: var(--accent-pink);
        }
        .check-circle { width: 14px; height: 14px; border: 1.5px solid var(--accent-pink); border-radius: 50%; background: white; }
        .check-circle.done { background-color: var(--accent-pink); color: white; line-height: 14px; font-size: 9px; }
        .check-circle.done::after { content: 'âœ“'; }

        .is-grayout { background-color: #eee !important; opacity: 0.4; pointer-events: none; }
        .cell-school { background-color: #e3f2fd; } 
        .cell-juku { background-color: #fff3e0; }
        .cell-dance { background-color: #f3e5f5; } 
        .cell-eng { background-color: #eeecff; } 
        .cell-book { background-color: #e8fff8; } 
        .cell-free { background-color: #f1f8e9; }

        #message {
            position: fixed; top: 15%; left: 50%; transform: translateX(-50%);
            background: var(--accent-pink); color: white; padding: 8px 16px; 
            border-radius: 20px; font-weight: bold; font-size: 0.9rem; z-index: 2000; 
            display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .stats-section { background: white; margin: 8px; padding: 8px; border-radius: 20px; border: 2px solid var(--main-pink); }
        .tab-btn { padding: 4px 12px; border-radius: 12px; border: 1px solid var(--main-pink); background: white; color: var(--accent-pink); font-size: 11px; cursor: pointer; font-weight: bold;}
        .tab-btn.active { background: var(--main-pink); color: white; }
        
        .year-report-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 8px; 
            margin-top: 10px;
        }
        .month-card { 
            background: #fffafb; 
            border: 1.5px solid var(--sub-pink); 
            border-radius: 15px; 
            padding: 10px; 
            text-align: left;
        }
        .month-title { color: var(--accent-pink); font-size: 13px; font-weight: bold; border-bottom: 1px dashed var(--main-pink); margin-bottom: 6px; text-align: center; }
        .stat-row { font-size: 11px; display: flex; justify-content: space-between; margin-bottom: 3px; color: #666; }

        #mascot-container { position: fixed; bottom: 10px; right: 10px; z-index: 900; }
        #mascot { font-size: 50px; }

        .sync-box { background: var(--sub-pink); margin: 8px; padding: 6px; border-radius: 10px; font-size: 9px; color: var(--accent-pink); }
        .btn-sm { background: white; border: 1px solid var(--accent-pink); color: var(--accent-pink); border-radius: 8px; padding: 2px 6px; cursor: pointer; }

        /* æ¶ˆå»ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn-clear-day {
            margin-top: 2px;
            padding: 2px 4px;
            font-size: 8px;
            background: #fff;
            color: #ff85a1;
            border: 1px solid #ff85a1;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-clear-day:active { background: #ffe4e8; }
    </style>
</head>
<body>

<div id="main-wrapper">
    <div id="message">ã‚„ã£ãŸã­ï¼ãˆã‚‰ã„ã£ğŸ“</div>

    <div class="top-nav">
        <h1>ğŸ€ ã‚­ãƒ©ã‚­ãƒ©æˆé•·ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« ğŸ€</h1>
        <div class="date-display">
            <button onclick="moveWeek(-1)">â—€</button>
            <span id="dateRangeDisplay">æ—¥ä»˜</span>
            <button onclick="moveWeek(1)">â–¶</button>
        </div>
    </div>

    <div class="palette" id="palette">
        <button class="palette-btn" data-task="school">ğŸ’å­¦æ ¡</button>
        <button class="palette-btn" data-task="juku_å›½èª" style="border-color:var(--juku-color); color:var(--juku-color);">ğŸ“–å¡¾(å›½)</button>
        <button class="palette-btn" data-task="juku_ç®—æ•°" style="border-color:var(--juku-color); color:var(--juku-color);">ğŸ“–å¡¾(ç®—)</button>
        <button class="palette-btn" data-task="juku_ç†ç§‘" style="border-color:var(--juku-color); color:var(--juku-color);">ğŸ“–å¡¾(ç†)</button>
        <button class="palette-btn" data-task="juku_ç¤¾ä¼š" style="border-color:var(--juku-color); color:var(--juku-color);">ğŸ“–å¡¾(ç¤¾)</button>
        <button class="palette-btn" data-task="eng" style="border-color:var(--eng-color); color:var(--eng-color);">ğŸ”¤è‹±èª</button>
        <button class="palette-btn" data-task="book" style="border-color:var(--book-color); color:var(--book-color);">ğŸ“šèª­æ›¸</button>
        <button class="palette-btn" data-task="dance">ğŸ’ƒãƒ€ãƒ³ã‚¹</button>
        <button class="palette-btn" data-task="free">âœï¸ã˜ã‚†ã†</button>
        <button class="palette-btn" data-task="clear">ğŸ§¹æ¶ˆã—ã‚´ãƒ </button>
    </div>

    <div class="scroll-container" id="mainScroll">
        <table>
            <thead><tr id="headerRow"><th class="time-col">ã˜ã‹ã‚“</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="stats-section">
        <div class="stats-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <select id="yearSelect" class="year-select" onchange="updateStats()" style="border:1.5px solid var(--main-pink); border-radius:10px; font-size:12px; color:var(--accent-pink); padding:3px;">
                <option value="2025">2025å¹´</option><option value="2026" selected>2026å¹´</option><option value="2027">2027å¹´</option>
            </select>
            <div class="tab-menu" style="display:flex; gap:6px;">
                <button class="tab-btn active" onclick="changeTab('week', this)">ä»Šé€±</button>
                <button class="tab-btn" onclick="yearReportMode()">ä»Šå¹´(é …ç›®åˆ¥)</button>
            </div>
        </div>
        <div id="statsContent"><div class="graph-area" id="graphArea"></div></div>
        <div id="ai-comment" style="font-size:11px; margin-top:8px; font-weight:bold; color:var(--accent-pink);"></div>
    </div>

    <div id="mascot-container"><span id="mascot">ğŸ§¸</span></div>

    <div class="sync-box">
        <button class="btn-sm" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn-sm" onclick="importData()">å—ã‘å–ã‚‹</button>
    </div>
</div>

<script>
    const SECRET_KEYWORD = "ãã¾ã•ã‚“"; 
    const days = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"];
    let currentMonday = getMonday(new Date());
    let selectedTask = null;
    let currentTab = 'week';

    function checkAuth() {
        const input = prompt("ğŸ§¸ ã‚ã„ã“ã¨ã°ã‚’ ã„ã‚Œã¦ã­ï¼");
        if (input === SECRET_KEYWORD) {
            document.getElementById('main-wrapper').style.display = 'block';
            init();
        } else {
            alert("ã¡ãŒã†ã‚ˆã€œï¼");
            location.reload();
        }
    }

    function init() {
        const header = document.getElementById('headerRow');
        days.forEach((day, i) => {
            const th = document.createElement('th');
            th.id = `col-header-${i}`;
            if(isThisDay(i)) th.classList.add('today-highlight');
            th.innerHTML = `${day}<br>
                <div style="background:white; color:black; font-size:8px; border-radius:5px; margin-top:3px; padding:2px; display:flex; flex-direction:column; gap:1px;">
                    <label style="display:flex; align-items:center; gap:1px;"><input type="checkbox" class="school-check" ${i<5?'checked':''} onchange="updateView()">å­¦æ ¡</label>
                    <select class="school-time" onchange="updateView()" style="font-size:8px; border:1px solid #ddd; border-radius:3px;">
                        <option value="15:30">6æ™‚é–“</option>
                        <option value="14:30">5æ™‚é–“</option>
                        <option value="13:30">åˆå‰</option>
                        <option value="12:30">çµ¦ç„¡</option>
                    </select>
                    <label style="color:#d32f2f; display:flex; align-items:center; gap:1px; border-top:1px dashed #eee; padding-top:1px;"><input type="checkbox" class="busy-check" onchange="updateView()">1æ—¥äºˆå®šã‚ã‚ŠğŸ’«</label>
                    <button class="btn-clear-day" onclick="clearDay(${i})">å…¨éƒ¨æ¶ˆã™ğŸ§¹</button>
                </div>`;
            header.appendChild(th);
        });

        for (let h = 7; h <= 22; h++) {
            for (let m of ['00', '30']) {
                if (h === 22 && m === '30') break;
                const row = document.createElement('tr');
                row.dataset.time = `${h}:${m}`;
                row.innerHTML = `<td class="time-col">${h}:${m}</td>` + 
                    Array(7).fill(0).map((_, i) => `<td data-day="${i}" onclick="applyTask(this, event)"><div class="content"></div><div class="done-wrapper"><div class="check-circle" onclick="toggleDone(event, this)"></div></div></td>`).join('');
                document.getElementById('tableBody').appendChild(row);
            }
        }
        updateView();
        setTimeout(scrollToToday, 500);
    }

    // æ›œæ—¥ã”ã¨ã®äºˆå®šã‚’ä¸€æ‹¬æ¶ˆå»ã™ã‚‹é–¢æ•°
    function clearDay(dayIdx) {
        if (!confirm(days[dayIdx] + "æ›œæ—¥ã®äºˆå®šã‚’å…¨éƒ¨æ¶ˆã—ã¦ã‚‚ã„ã„ã‹ãªï¼Ÿ")) return;
        
        const cells = document.querySelectorAll(`#tableBody td[data-day="${dayIdx}"]`);
        cells.forEach(td => {
            td.querySelector('.content').innerHTML = '';
            // ä»Šæ—¥ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯æ®‹ã—ã¤ã¤ã€ã‚¿ã‚¹ã‚¯è‰²ã ã‘æ¶ˆã™
            td.className = isThisDay(dayIdx) ? 'today-highlight' : '';
            // å®Œäº†ãƒã‚§ãƒƒã‚¯ã‚‚å¤–ã™
            const check = td.querySelector('.check-circle');
            if (check) check.classList.remove('done');
        });
        saveData();
        updateStats();
    }

    function isThisDay(dayIdx) {
        const d = new Date();
        const targetDate = new Date(currentMonday);
        targetDate.setDate(targetDate.getDate() + dayIdx);
        return d.toDateString() === targetDate.toDateString();
    }

    function scrollToToday() {
        const todayIdx = (new Date().getDay() + 6) % 7; 
        const targetHeader = document.getElementById(`col-header-${todayIdx}`);
        if (targetHeader) document.getElementById('mainScroll').scrollTo({ left: targetHeader.offsetLeft - 40, behavior: 'smooth' });
    }

    document.querySelectorAll('.palette-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.palette-btn').forEach(b => b.classList.remove('active'));
            selectedTask = (selectedTask === btn.dataset.task) ? null : btn.dataset.task;
            if(selectedTask) btn.classList.add('active');
        };
    });

    async function applyTask(td, event) {
        if (!selectedTask || event.target.closest('.done-wrapper')) return;
        const content = td.querySelector('.content');
        if (selectedTask === 'clear') { 
            content.innerHTML = ''; 
            td.className = isThisDay(td.dataset.day)?'today-highlight':''; 
        } else {
            let type = selectedTask.split('_')[0];
            let sub = selectedTask.split('_')[1] || "";
            let label = "";
            if (type === 'free') {
                await new Promise(r => setTimeout(r, 10));
                const val = prompt("ãªã«ã™ã‚‹ï¼Ÿ", "ã˜ã‚†ã†");
                label = val ? "âœï¸" + val : "âœï¸ã˜ã‚†ã†";
            } else if (type === 'juku') {
                label = "ğŸ“–å¡¾(" + sub + ")";
            } else {
                const labels = {school:"ğŸ’å­¦æ ¡", eng:"ğŸ”¤è‹±èª", book:"ğŸ“šèª­æ›¸", dance:"ğŸ’ƒãƒ€ãƒ³ã‚¹"};
                label = labels[type];
            }
            td.className = (isThisDay(td.dataset.day)?'today-highlight ':'') + 'cell-' + type;
            content.innerHTML = label;
        }
        saveData(); updateStats();
    }

    function toggleDone(e, el) {
        e.stopPropagation(); el.classList.toggle('done');
        if(el.classList.contains('done')) {
            const msg = document.getElementById('message');
            msg.style.display = 'block';
            setTimeout(()=> msg.style.display='none', 1000);
        }
        saveData(); updateStats();
    }

    function yearReportMode() { currentTab = 'year'; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.tab-btn')[1].classList.add('active'); updateStats(); }

    function updateStats() {
        const container = document.getElementById('statsContent');
        const aiComment = document.getElementById('ai-comment');
        const selectedYear = document.getElementById('yearSelect').value;
        if (currentTab === 'week') {
            container.innerHTML = '<div class="graph-area" id="graphArea" style="display:flex; align-items:flex-end; height:100px; border-bottom:1px solid var(--sub-pink); justify-content:space-around; margin-top:15px;"></div>';
            const area = document.getElementById('graphArea');
            let stats = { "å­¦æ ¡":0, "å¡¾":0, "è‹±èª":0, "èª­æ›¸":0, "ãƒ€ãƒ³ã‚¹":0, "è‡ªç”±":0 };
            const data = JSON.parse(localStorage.getItem("week_" + currentMonday.toISOString().split('T')[0]) || "[]");
            data.forEach(item => {
                if(item.done) {
                    if(item.class.includes('school')) stats["å­¦æ ¡"]++;
                    else if(item.class.includes('juku')) stats["å¡¾"]++;
                    else if(item.class.includes('eng')) stats["è‹±èª"]++;
                    else if(item.class.includes('book')) stats["èª­æ›¸"]++;
                    else if(item.class.includes('dance')) stats["ãƒ€ãƒ³ã‚¹"]++;
                    else if(item.class.includes('free')) stats["è‡ªç”±"]++;
                }
            });
            const max = Math.max(...Object.values(stats), 1);
            Object.entries(stats).forEach(([name, count]) => {
                area.innerHTML += `<div style="height:${(count/max)*80}px; width:18px; background:var(--main-pink); border-radius:4px 4px 0 0; position:relative;">
                    <div style="position:absolute; top:-12px; width:100%; font-size:7px;">${count/2}h</div>
                    <div style="position:absolute; bottom:-12px; width:100%; font-size:7px; white-space:nowrap;">${name}</div>
                </div>`;
            });
            aiComment.textContent = "ä»Šé€±ã‚‚ã‚ˆããŒã‚“ã°ã£ã¦ã‚‹ã­ï¼ğŸ“";
        } else {
            let yearlyData = {};
            for(let m=1; m<=12; m++) yearlyData[m] = { "å­¦":0, "å¡¾":0, "è‹±":0, "èª­":0, "ãƒ€":0, "è‡ª":0 };
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (!key.startsWith('week_')) continue;
                const d = new Date(key.replace('week_',''));
                if (d.getFullYear().toString() === selectedYear) {
                    const data = JSON.parse(localStorage.getItem(key));
                    data.forEach(item => {
                        if(item.done) {
                            let m = d.getMonth() + 1;
                            if(item.class.includes('school')) yearlyData[m]["å­¦"]++;
                            else if(item.class.includes('juku')) yearlyData[m]["å¡¾"]++;
                            else if(item.class.includes('eng')) yearlyData[m]["è‹±"]++;
                            else if(item.class.includes('book')) yearlyData[m]["èª­"]++;
                            else if(item.class.includes('dance')) yearlyData[m]["ãƒ€"]++;
                            else if(item.class.includes('free')) yearlyData[m]["è‡ª"]++;
                        }
                    });
                }
            }
            let html = '<div class="year-report-container">';
            for(let m=1; m<=12; m++) {
                html += `<div class="month-card">
                    <div class="month-title">${m}æœˆ</div>
                    <div class="stat-row"><span>ğŸ’ å­¦æ ¡</span><span>${yearlyData[m]["å­¦"]/2}h</span></div>
                    <div class="stat-row"><span>ğŸ“– å¡¾</span><span>${yearlyData[m]["å¡¾"]/2}h</span></div>
                    <div class="stat-row"><span>ğŸ”¤ è‹±èª</span><span>${yearlyData[m]["è‹±"]/2}h</span></div>
                    <div class="stat-row"><span>ğŸ“š èª­æ›¸</span><span>${yearlyData[m]["èª­"]/2}h</span></div>
                    <div class="stat-row"><span>ğŸ’ƒ ãƒ€ãƒ³ã‚¹</span><span>${yearlyData[m]["ãƒ€"]/2}h</span></div>
                    <div class="stat-row"><span>âœï¸ è‡ªç”±</span><span>${yearlyData[m]["è‡ª"]/2}h</span></div>
                </div>`;
            }
            container.innerHTML = html + '</div>';
            aiComment.textContent = selectedYear + "å¹´ã®æˆé•·ã®ãã‚ãã ã‚ˆâœ¨";
        }
    }

    function getMonday(d) { d = new Date(d); d.setHours(0,0,0,0); let day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6:1); return new Date(d.setDate(diff)); }
    function updateView() {
        const start = currentMonday;
        const end = new Date(currentMonday); end.setDate(start.getDate() + 6);
        const format = (d) => `${d.getMonth() + 1}/${d.getDate()}(${days[(d.getDay() + 6) % 7]})`;
        document.getElementById('dateRangeDisplay').textContent = `${format(start)} ã€œ ${format(end)}`;
        loadData(); refreshGrayOut(); updateStats();
    }
    function saveData() {
        const key = "week_" + currentMonday.toISOString().split('T')[0];
        const data = Array.from(document.querySelectorAll('#tableBody td[data-day]')).map(td => ({ class: td.className, html: td.querySelector('.content').innerHTML, done: td.querySelector('.check-circle').classList.contains('done') }));
        localStorage.setItem(key, JSON.stringify(data));
    }
    function loadData() {
        const key = "week_" + currentMonday.toISOString().split('T')[0];
        const data = JSON.parse(localStorage.getItem(key) || "[]");
        document.querySelectorAll('#tableBody td[data-day]').forEach((td, i) => {
            td.className = isThisDay(td.dataset.day) ? 'today-highlight' : '';
            if(data[i]) { td.className = data[i].class; td.querySelector('.content').innerHTML = data[i].html; if(data[i].done) td.querySelector('.check-circle').classList.add('done'); }
        });
    }
    function moveWeek(n) { currentMonday.setDate(currentMonday.getDate() + n*7); updateView(); }
    function changeTab(t, btn) { currentTab = t; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateStats(); }
    
    function refreshGrayOut() {
        const sChecks = document.querySelectorAll('.school-check'), bChecks = document.querySelectorAll('.busy-check'), sTimes = document.querySelectorAll('.school-time');
        document.querySelectorAll('#tableBody tr').forEach(row => {
            const time = parseInt(row.dataset.time.replace(':',''));
            for(let d=0; d<7; d++) {
                const td = row.cells[d+1];
                const limit = parseInt(sTimes[d].value.replace(':',''));
                if(bChecks[d].checked || (sChecks[d].checked && time >= 800 && time < limit)) td.classList.add('is-grayout'); else td.classList.remove('is-grayout');
            }
        });
    }
    function exportData() { navigator.clipboard.writeText(JSON.stringify(localStorage)).then(() => alert("ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼")); }
    function importData() { const json = prompt("ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ã­"); if(json) { Object.assign(localStorage, JSON.parse(json)); location.reload(); } }

    checkAuth();
</script>
</body>
</html>
