<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆé•·è¨˜éŒ²ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</title>

    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2362/2362789.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2362/2362789.png">
    <style>
        :root {
            --bg-color: #fffaf5;
            --main-pink: #ff9a9e;
            --main-yellow: #fff9aa;
            --gray-out: #d0d0d0;
            --juku-color: #FF9800;
        }
        /* æœ€åˆã¯ä¸­èº«ã‚’éš ã—ã¦ãŠã */
        #main-wrapper { display: none; }

        body { font-family: 'Hiragino Sans', sans-serif; background-color: var(--bg-color); margin: 0; text-align: center; color: #333; padding-bottom: 100px; }
        
        .top-nav { background: white; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        h1 { color: #ff6f91; font-size: 1.2rem; margin: 5px 0; }
        .date-display { font-weight: bold; font-size: 0.95rem; color: #ff6f91; margin: 5px 0; display: flex; align-items: center; justify-content: center; gap: 10px;}

        #message {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 111, 145, 0.95); color: white; padding: 20px; border-radius: 50px;
            font-weight: bold; font-size: 1.5rem; z-index: 2000; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .palette { background: #fff; padding: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; border-bottom: 2px solid #ffd1dc; }
        .palette-btn { padding: 8px 12px; border-radius: 15px; border: 2px solid #eee; background: white; cursor: pointer; font-size: 12px; font-weight: bold; white-space: nowrap; }
        .palette-btn.active { border-color: #ff6f91; background: #ffeef2; transform: scale(1.05); }

        .scroll-container { overflow: auto; height: 50vh; background: white; -webkit-overflow-scrolling: touch; }
        table { border-collapse: collapse; min-width: 1000px; width: 100%; table-layout: fixed; }
        thead th { position: sticky; top: 0; z-index: 400; background-color: var(--main-pink); color: white; padding: 10px 2px; border: 1px solid #ffe0e6; font-size: 0.8rem; }
        .time-col { background: #fff0f3; font-weight: bold; width: 50px; position: sticky; left: 0; z-index: 300; vertical-align: middle; border: 1px solid #ffe0e6; }
        
        td { height: 80px; border: 1px solid #ffe0e6; vertical-align: top; cursor: pointer; position: relative; }
        .content { font-size: 11px; font-weight: bold; padding: 4px 2px; word-break: break-all; line-height: 1.2; }
        .today-highlight { background-color: #fff9c4 !important; color: #d81b60 !important; border: 2px solid #ff6f91 !important; }

        .done-wrapper { display: flex; align-items: center; justify-content: center; gap: 3px; margin-top: 5px; font-size: 10px; color: #ff6f91; font-weight: bold; position: absolute; bottom: 5px; width: 100%; }
        .check-circle { width: 18px; height: 18px; border: 2px solid #ff6f91; border-radius: 50%; background: white; }
        .check-circle.done { background-color: #ff6f91; color: white; line-height: 18px; }
        .check-circle.done::after { content: '''; }

        .is-grayout { background-color: var(--gray-out) !important; opacity: 0.5; pointer-events: none; }
        .cell-school { background-color: #e3f2fd; } .cell-juku { background-color: #fff3e0; }
        .cell-dance { background-color: #f3e5f5; } .cell-free { background-color: #f1f8e9; }

        .stats-section { background: white; margin: 15px; padding: 15px; border-radius: 20px; border: 3px solid #ffd1dc; }
        .stats-header { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .tab-menu { display: flex; gap: 10px; }
        .tab-btn { padding: 5px 15px; border-radius: 10px; border: 1px solid #ccc; background: #eee; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: #ff6f91; color: white; border-color: #ff6f91; }
        
        .year-report-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 10px; }
        .month-card { background: #fffafb; border: 1px solid #ffd1dc; border-radius: 15px; padding: 10px; text-align: left; }
        .month-title { font-weight: bold; color: #ff6f91; border-bottom: 1px dashed #ffd1dc; margin-bottom: 5px; text-align: center; font-size: 14px; }
        .stat-row { font-size: 11px; display: flex; justify-content: space-between; margin-bottom: 2px; }

        .graph-area { display: flex; align-items: flex-end; justify-content: space-around; height: 160px; margin-top: 30px; padding-bottom: 25px; border-bottom: 2px solid #ff9a9e; }
        .bar { width: 30px; background: linear-gradient(to top, #ff9a9e, #fecfef); border-radius: 8px 8px 0 0; position: relative; min-height: 2px; }
        .bar-label { position: absolute; top: -20px; width: 100%; font-size: 9px; font-weight: bold; color: #ff6f91; }
        .bar-name { position: absolute; bottom: -22px; width: 100%; font-size: 8px; font-weight: bold; }

        #mascot-container { position: fixed; bottom: 20px; right: 20px; z-index: 900; }
        #mascot { font-size: 80px; cursor: pointer; animation: floatY 3s ease-in-out infinite; transition: transform 0.2s; display: block; }
        @keyframes floatY { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        #mascot:active { transform: scale(1.2) translateY(-20px) !important; }

        .sync-box { background: #f0f0f0; margin: 15px; padding: 10px; border-radius: 10px; font-size: 11px; }
        .year-select { padding: 5px; border-radius: 10px; border: 2px solid #ff6f91; font-weight: bold; color: #ff6f91; outline: none; }
    </style>
</head>
<body>

<div id="main-wrapper">
    <div id="message">ã™ã”ã„ï¼ï¼é ‘å¼µã£ãŸã­=ï¾˜ï¾</div>

    <div class="top-nav">
        <h1>=ï¾˜å·–æ¯æ—¥ã®ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«=ï¾˜å·–</h1>
        <div class="date-display">
            <button onclick="moveWeek(-1)">ï¾€%</button>
            <span id="dateRangeDisplay">æ—¥ä»˜</span>
            <button onclick="moveWeek(1)">ï½¶%</button>
        </div>
    </div>

    <div class="palette" id="palette">
        <button class="palette-btn" data-task="school"><ï¾˜é¶´å­¦æ ¡å®¿é¡Œ</button>
        <button class="palette-btn" data-task="dance">=ï¾˜ãƒ»ãƒ€ãƒ³ã‚¹</button>
        <button class="palette-btn" data-task="juku_å›½èª" style="border-color:orange;color:orange;">=ï¾˜ï¾–ï¾œå¡¾(å›½)</button>
        <button class="palette-btn" data-task="juku_ç®—æ•°" style="border-color:orange;color:orange;">=ï¾˜ï¾–ï¾œå¡¾(ç®—)</button>
        <button class="palette-btn" data-task="juku_ç†ç§‘" style="border-color:orange;color:orange;">=ï¾˜ï¾–ï¾œå¡¾(ç†)</button>
        <button class="palette-btn" data-task="juku_ç¤¾ä¼š" style="border-color:orange;color:orange;">=ï¾˜ï¾–ï¾œå¡¾(ç¤¾)</button>
        <button class="palette-btn" data-task="free">'ï¸€ã˜ã‚†ã†</button>
        <button class="palette-btn" data-task="clear">>ï¾˜îœ¸ã‘ã—ã”ã‚€</button>
    </div>

    <div class="scroll-container" id="mainScroll">
        <table>
            <thead><tr id="headerRow"><th class="time-col">ã˜ã‹ã‚“</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="stats-section">
        <div class="stats-header">
            <select id="yearSelect" class="year-select" onchange="updateStats()">
                <option value="2025">2025å¹´</option>
                <option value="2026" selected>2026å¹´</option>
                <option value="2027">2027å¹´</option>
            </select>
            <div class="tab-menu">
                <button class="tab-btn active" onclick="changeTab('week', this)">ä»Šé€±</button>
                <button class="tab-btn" onclick="yearReportMode()">ä»Šå¹´(é …ç›®åˆ¥)</button>
            </div>
        </div>
        <div id="statsContent"><div class="graph-area" id="graphArea"></div></div>
        <div id="ai-comment" style="margin-top:20px; font-weight:bold; color:#ff6f91; min-height: 1.5em;"></div>
    </div>

    <div id="mascot-container"><span id="mascot">>ï¾˜î™¼</span></div>

    <div class="sync-box">
        <b>=ï¾˜î…— ãƒ‡ãƒ¼ã‚¿åŒæœŸ</b><br>
        <button class="btn-sm" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn-sm" onclick="importData()">ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹</button>
    </div>
</div>

<script>
    // â˜…â˜…â˜… ã“ã“ã§ã€Œã‚ã„ã“ã¨ã°ã€ã‚’è¨­å®šã—ã¦ã­ â˜…â˜…â˜…
    const SECRET_KEYWORD = "bear123"; 

    const days = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"];
    let currentMonday = getMonday(new Date());
    let selectedTask = null;
    let currentTab = 'week';

    function checkAuth() {
        const input = prompt(">ï¾˜î™¼ ã‚ã„ã“ã¨ã°ã‚’ ã„ã‚Œã¦ã­ï¼");
        if (input === SECRET_KEYWORD) {
            document.getElementById('main-wrapper').style.display = 'block';
            init();
        } else {
            alert("ã‚ã„ã“ã¨ã°ãŒ ã¡ãŒã†ã‚ˆã€‚ãƒšãƒ¼ã‚¸ã‚’ã²ã‚‰ããªãŠã—ã¦ã­ï¼");
            document.body.innerHTML = "<div style='margin-top:50px;'><h1>=ï¾˜ï¾ èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ</h1><p>æ­£ã—ã„ ã‚ã„ã“ã¨ã°ã‚’ã„ã‚Œã¦ã­ã€‚</p></div>";
        }
    }

    function init() {
        const header = document.getElementById('headerRow');
        days.forEach((day, i) => {
            const th = document.createElement('th');
            th.id = `col-header-${i}`;
            if(isThisDay(i)) th.classList.add('today-highlight');
            th.innerHTML = `${day}æ›œæ—¥<br>
                <div style="background:white; color:black; font-size:9px; border-radius:5px; margin-top:5px; padding:4px;">
                    <label><input type="checkbox" class="school-check" ${i<5?'checked':''} onchange="updateView()">å­¦æ ¡</label>
                    <select class="school-time" onchange="updateView()" style="font-size:9px;">
                        <option value="15:30">6æ™‚é–“</option><option value="14:30">5æ™‚é–“</option><option value="13:30">åˆå‰</option>
                    </select>
                    <label style="color:#d32f2f;"><input type="checkbox" class="busy-check" onchange="updateView()">1æ—¥=ï¾˜ï½«ï¾œ</label>
                </div>`;
            header.appendChild(th);
        });

        for (let h = 7; h <= 22; h++) {
            for (let m of ['00', '30']) {
                if (h === 22 && m === '30') break;
                const row = document.createElement('tr');
                row.dataset.time = `${h}:${m}`;
                row.innerHTML = `<td class="time-col">${h}:${m}</td>` + 
                    Array(7).fill(0).map((_, i) => `<td data-day="${i}" onclick="applyTask(this, event)"><div class="content"></div><div class="done-wrapper"><div class="check-circle" onclick="toggleDone(event, this)"></div>å®Œäº†</div></td>`).join('');
                document.getElementById('tableBody').appendChild(row);
            }
        }
        updateView();
        setTimeout(scrollToToday, 500);
    }

    function isThisDay(dayIdx) {
        const d = new Date();
        const targetDate = new Date(currentMonday);
        targetDate.setDate(targetDate.getDate() + dayIdx);
        return d.toDateString() === targetDate.toDateString();
    }
    function scrollToToday() {
        const today = new Date();
        const todayIdx = (today.getDay() + 6) % 7; 
        const targetHeader = document.getElementById(`col-header-${todayIdx}`);
        if (targetHeader) document.getElementById('mainScroll').scrollTo({ left: targetHeader.offsetLeft - 60, behavior: 'smooth' });
    }
    document.querySelectorAll('.palette-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.palette-btn').forEach(b => b.classList.remove('active'));
            selectedTask = (selectedTask === btn.dataset.task) ? null : btn.dataset.task;
            if(selectedTask) btn.classList.add('active');
        };
    });
    function applyTask(td, event) {
        if (!selectedTask || event.target.closest('.done-wrapper')) return;
        const content = td.querySelector('.content');
        if (selectedTask === 'clear') { content.innerHTML = ''; td.className = isThisDay(td.dataset.day)?'today-highlight':''; }
        else {
            let type = selectedTask.split('_')[0];
            let sub = selectedTask.split('_')[1] || "";
            td.className = (isThisDay(td.dataset.day)?'today-highlight ':'') + 'cell-' + type;
            content.innerHTML = type==='school'?"<ï¾˜é¶´å®¿é¡Œ":type==='juku'?"=ï¾˜ï¾–ï¾œå¡¾("+sub+")":type==='dance'?"=ï¾˜ãƒ»ãƒ€ãƒ³ã‚¹":"'ï¸€è‡ªç”±";
        }
        saveData(); updateStats();
    }
    function toggleDone(e, el) {
        e.stopPropagation(); el.classList.toggle('done');
        if(el.classList.contains('done')) {
            document.getElementById('message').style.display = 'block';
            setTimeout(()=> document.getElementById('message').style.display='none', 1000);
        }
        saveData(); updateStats();
    }
    function yearReportMode() {
        currentTab = 'year';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        updateStats();
    }
    function updateStats() {
        const container = document.getElementById('statsContent');
        const aiComment = document.getElementById('ai-comment');
        const selectedYear = document.getElementById('yearSelect').value;
        if (currentTab === 'week') {
            container.innerHTML = '<div class="graph-area" id="graphArea"></div>';
            const area = document.getElementById('graphArea');
            let stats = { "å­¦æ ¡":0, "å¡¾":0, "ãƒ€ãƒ³ã‚¹":0, "è‡ªç”±":0 };
            const data = JSON.parse(localStorage.getItem("week_" + currentMonday.toISOString().split('T')[0]) || "[]");
            data.forEach(item => {
                if(item.done) {
                    if(item.class.includes('school')) stats["å­¦æ ¡"]++;
                    else if(item.class.includes('juku')) stats["å¡¾"]++;
                    else if(item.class.includes('dance')) stats["ãƒ€ãƒ³ã‚¹"]++;
                    else if(item.class.includes('free')) stats["è‡ªç”±"]++;
                }
            });
            const max = Math.max(...Object.values(stats), 1);
            Object.entries(stats).forEach(([name, count]) => {
                area.innerHTML += `<div class="bar" style="height:${(count/max)*120}px"><div class="bar-label">${count/2}h</div><div class="bar-name">${name}</div></div>`;
            });
            aiComment.textContent = "ä»Šé€±ã®é ‘å¼µã‚ŠãŒè¦‹ãˆã‚‹ã­ï¼";
        } else {
            let yearlyData = {};
            for(let m=1; m<=12; m++) yearlyData[m] = { "å­¦æ ¡":0, "å¡¾":0, "ãƒ€ãƒ³ã‚¹":0, "è‡ªç”±":0 };
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (!key.startsWith('week_')) continue;
                const d = new Date(key.replace('week_',''));
                if (d.getFullYear().toString() === selectedYear) {
                    const data = JSON.parse(localStorage.getItem(key));
                    data.forEach(item => {
                        if(item.done) {
                            let m = d.getMonth() + 1;
                            if(item.class.includes('school')) yearlyData[m]["å­¦æ ¡"]++;
                            else if(item.class.includes('juku')) yearlyData[m]["å¡¾"]++;
                            else if(item.class.includes('dance')) yearlyData[m]["ãƒ€ãƒ³ã‚¹"]++;
                            else if(item.class.includes('free')) yearlyData[m]["è‡ªç”±"]++;
                        }
                    });
                }
            }
            let html = '<div class="year-report-container">';
            for(let m=1; m<=12; m++) {
                html += `<div class="month-card"><div class="month-title">${m}æœˆ</div><div class="stat-row"><span><ï¾˜é¶´å®¿é¡Œ</span><span>${yearlyData[m]["å­¦æ ¡"]/2}h</span></div><div class="stat-row"><span>=ï¾˜ï¾–ï¾œå¡¾</span><span>${yearlyData[m]["å¡¾"]/2}h</span></div><div class="stat-row"><span>=ï¾˜ãƒ»ãƒ€ãƒ³ã‚¹</span><span>${yearlyData[m]["ãƒ€ãƒ³ã‚¹"]/2}h</span></div><div class="stat-row"><span>'ï¸€è‡ªç”±</span><span>${yearlyData[m]["è‡ªç”±"]/2}h</span></div></div>`;
            }
            container.innerHTML = html + '</div>';
            aiComment.textContent = selectedYear + "å¹´ã®æˆé•·ã®è¨˜éŒ²ã ã‚ˆï¼('";
        }
    }
    function getMonday(d) { d = new Date(d); d.setHours(0,0,0,0); let day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6:1); return new Date(d.setDate(diff)); }
    function updateView() {
        const start = currentMonday;
        const end = new Date(currentMonday); end.setDate(start.getDate() + 6);
        const format = (d) => `${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥(${days[(d.getDay() + 6) % 7]})`;
        document.getElementById('dateRangeDisplay').textContent = `${format(start)} ï½ ${format(end)} (${start.getFullYear()}å¹´)`;
        loadData(); refreshGrayOut(); updateStats();
    }
    function saveData() {
        const key = "week_" + currentMonday.toISOString().split('T')[0];
        const data = Array.from(document.querySelectorAll('#tableBody td[data-day]')).map(td => ({ class: td.className, html: td.querySelector('.content').innerHTML, done: td.querySelector('.check-circle').classList.contains('done') }));
        localStorage.setItem(key, JSON.stringify(data));
    }
    function loadData() {
        const key = "week_" + currentMonday.toISOString().split('T')[0];
        const data = JSON.parse(localStorage.getItem(key) || "[]");
        document.querySelectorAll('#tableBody td[data-day]').forEach((td, i) => {
            td.className = isThisDay(td.dataset.day) ? 'today-highlight' : '';
            if(data[i]) { td.className = data[i].class; td.querySelector('.content').innerHTML = data[i].html; if(data[i].done) td.querySelector('.check-circle').classList.add('done'); }
        });
    }
    function moveWeek(n) { currentMonday.setDate(currentMonday.getDate() + n*7); updateView(); }
    function changeTab(t, btn) { currentTab = t; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateStats(); }
    function refreshGrayOut() {
        const sChecks = document.querySelectorAll('.school-check'), bChecks = document.querySelectorAll('.busy-check'), sTimes = document.querySelectorAll('.school-time');
        document.querySelectorAll('#tableBody tr').forEach(row => {
            const time = parseInt(row.dataset.time.replace(':',''));
            for(let d=0; d<7; d++) {
                const td = row.cells[d+1], limit = parseInt(sTimes[d].value.replace(':',''));
                if(bChecks[d].checked || (sChecks[d].checked && time >= 800 && time < limit)) td.classList.add('is-grayout'); else td.classList.remove('is-grayout');
            }
        });
    }
    function exportData() { navigator.clipboard.writeText(JSON.stringify(localStorage)).then(() => alert("ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼")); }
    function importData() { const json = prompt("ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ã­"); if(json) { Object.assign(localStorage, JSON.parse(json)); location.reload(); } }

    // æœ€åˆã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    checkAuth();
</script>
</body>
</html>